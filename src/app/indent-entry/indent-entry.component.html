<mat-card>
  <mat-card-header class="justify-content-center">
    <mat-card-title>Indent Entry</mat-card-title>
  </mat-card-header>
  <mat-divider></mat-divider>
  <mat-card-content>
    <form [formGroup]="form">
      <div class="row">
        <div class="col-6 col-sm-6 col-md-4 col-lg-4">
          <mat-form-field appearance="fill">
            <mat-label>Stock Req. No</mat-label>
            <input type="text" matInput formControlName="StockReqNo" readonly />
            <mat-error>Field Required</mat-error>
          </mat-form-field>
        </div>
        <div class="col-6 col-sm-6 col-md-4 col-lg-4" style="margin-top: 3px;">
          <mat-form-field appearance="fill">
            <mat-label>Indent Date</mat-label>
            <input matInput [matDatepicker]="picker" formControlName="IndentDate">
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
            <mat-error>Field Required</mat-error>
          </mat-form-field>
        </div>
        <div class="col-6 col-sm-6 col-md-4 col-lg-4">
          <mat-form-field appearance="fill">
            <mat-label>Cost Center</mat-label>
            <mat-select formControlName="costcenter">
              <mat-option *ngFor="let item of costcentreArr"
                [value]="item.costcentreid">{{item.costcentre}}</mat-option>
            </mat-select>
            <mat-error>Field Required</mat-error>
          </mat-form-field>
        </div>
        <div class="col-6 col-sm-6 col-md-4 col-lg-4" style="margin-top: 3px;">
          <mat-form-field appearance="fill">
            <mat-label>From Date</mat-label>
            <input matInput [matDatepicker]="picker1" formControlName="FromDate"
              (dateChange)="frmDatechangeEvent($event)">
            <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
            <mat-datepicker #picker1></mat-datepicker>
            <mat-error>Field Required</mat-error>
          </mat-form-field>
        </div>
        <div class="col-6 col-sm-6 col-md-4 col-lg-4" style="margin-top: 3px;">
          <mat-form-field appearance="fill">
            <mat-label>To Date</mat-label>
            <input matInput [matDatepicker]="picker2" formControlName="Todate">
            <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
            <mat-datepicker #picker2></mat-datepicker>
            <mat-error>Field Required</mat-error>
          </mat-form-field>
        </div>
        <div class="col-6 col-sm-6 col-md-4 col-lg-4">
          <mat-form-field appearance="fill">
            <mat-label>Category</mat-label>
            <mat-select formControlName="Category">
              <mat-option *ngFor="let item of categoryArr" [value]="item.catid">{{item.catname}}</mat-option>
            </mat-select>
            <mat-error>Field Required</mat-error>
          </mat-form-field>
        </div>
        <div class="col-6 col-sm-6 col-md-4 col-lg-4">
          <mat-form-field appearance="fill">
            <mat-label>Department</mat-label>
            <mat-select formControlName="dept" (selectionChange)="deptChangeevent()">
              <mat-option *ngFor="let item of DepartmentArr" [value]="item.DeptId">{{item.DeptName}}</mat-option>
            </mat-select>
            <mat-error>Field Required</mat-error>
          </mat-form-field>
        </div>
        <div class="col-6 col-sm-6 col-md-4 col-lg-4">
          <mat-form-field appearance="fill">
            <mat-label>Approved By</mat-label>
            <mat-select formControlName="Approvedby">
              <mat-option *ngFor="let item of ApprovedbyArr" [value]="item.empid">{{item.empname}}</mat-option>
            </mat-select>
            <mat-error>Field Required</mat-error>
          </mat-form-field>
        </div>
        <div class="col-6 col-sm-6 col-md-4 col-lg-4">
          <mat-form-field appearance="fill">
            <mat-label>Login Employee</mat-label>
            <input type="text" matInput formControlName="Emp" readonly />
            <mat-error>Field Required</mat-error>
          </mat-form-field>
        </div>
        <div class="col-6 col-sm-6 col-md-4 col-lg-4">
          <mat-form-field>
            <mat-label>Indent_Raise_Emp</mat-label>
            <mat-select formControlName="IndentRaiseEmp">
              <mat-option>
                <ngx-mat-select-search [formControl]="EmpfilterControl" [clearSearchInput]="true"
                  placeholderLabel="---Search---">
                </ngx-mat-select-search></mat-option>
              <mat-option *ngFor="let item of EmpArrfilter" [value]="item.empid">{{item.empname}}</mat-option>
            </mat-select>
            <mat-error>Field Required</mat-error>
          </mat-form-field>
        </div>
        <div class="col-6 col-sm-6 col-md-4 col-lg-4">
          <mat-form-field>
            <mat-label>Pur_Dept_Res_Emp</mat-label>
            <mat-select formControlName="PurDeptResponse">
              <mat-option *ngFor="let item of ResponsableEmpArr" [value]="item.empid">{{item.empname}}</mat-option>
            </mat-select>
            <mat-error>Field Required</mat-error>
          </mat-form-field>
        </div>
        <div class="col-6 col-sm-6 col-md-4 col-lg-4">
          <mat-form-field appearance="fill">
            <mat-label>Description </mat-label>
            <!-- <mat-input-container floatPlaceholder="auto"> -->
              <textarea matInput formControlName="desc" style="field-sizing: content;"></textarea>
            <!-- </mat-input-container> -->
            <mat-error>Field Required</mat-error>
          </mat-form-field>
        </div>
        <div class="col-12 col-sm-12 col-md-6 col-lg-8">
          <mat-form-field>
            <mat-label>Rawmaterial</mat-label>
            <mat-select formControlName="Rawmaterial">
              <mat-option>
                <ngx-mat-select-search [formControl]="filterControl" [clearSearchInput]="true"
                  placeholderLabel="---Search---">
                </ngx-mat-select-search></mat-option>
              <mat-option *ngFor="let item of MaterialArrfilter"
                [value]="item.RawMatID">{{item.rawmatname}}</mat-option>
            </mat-select>
            <mat-error>Field Required</mat-error>
          </mat-form-field>
        </div>
        <div class="col-6 col-sm-6 col-md-6 col-lg-4">
          <mat-radio-group aria-label="Select an option" formControlName="prnewtype" (change)="PrTypeChangeEvent()">
            <mat-radio-button class="" value="1" checked>Regular</mat-radio-button>
            <mat-radio-button class="" value="2" style="padding-right: 2%;">Capex</mat-radio-button>
          </mat-radio-group>
        </div>
        <div class="col-6 col-sm-6 col-md-4 col-lg-4" *ngIf="this.form.controls['prnewtype'].value =='2'">
          <mat-form-field appearance="fill">
            <mat-label>Capex</mat-label>
            <mat-select formControlName="Capex" (selectionChange)="CapexChangeEvent()">
              <mat-option *ngFor="let item of CapexArr" [value]="item.capexno">{{item.tranno}}</mat-option>
            </mat-select>
            <mat-error>Field Required</mat-error>
          </mat-form-field>
        </div>
        <div class="col-6 col-sm-6 col-md-4 col-lg-4 d-flex align-items-center gap-2"
          *ngIf="this.form.controls['prnewtype'].value =='2'">
          <label for="exampleFormControlInput3" class="form-label">Attachmnet</label>
          <input type="file" #fileInput style="display: none" (change)="onFileSelected($event)" />
          <button mat-raised-button (click)="fileInput.click()"
            style="margin-right: 2%; background-color: rgb(60, 150, 235);">
            Browse </button>
          <button id="uploadserver" mat-raised-button style="background-color: rgb(54, 221, 54);"
            (click)="AddAttachment()">
            Upload </button>
        </div>
      </div>
    </form>
    <div class="col modal-footer">
      <button mat-raised-button type="button" color="primary" (click)="getStoreRelease()">View</button>
    </div>
    <div class="mat-elevation-z8 mt-3">
      <mat-form-field appearance="fill">
        <mat-label>Material-Search</mat-label>
        <input matInput type="text" class="" placeholder="Search" (input)="materialInput($event)">
      </mat-form-field>
      <table mat-table #table [dataSource]="dataSource">
        <ng-container matColumnDef="Select">
          <th mat-header-cell *matHeaderCellDef> Select </th>
          <td mat-cell *matCellDef="let row"><mat-checkbox [(ngModel)]="row.Select" color="primary"></mat-checkbox></td>
        </ng-container>
        <ng-container matColumnDef="RefNo">
          <th mat-header-cell *matHeaderCellDef> RefNo </th>
          <td mat-cell *matCellDef="let row"> {{row.Sr_Ref_No}} </td>
        </ng-container>
        <ng-container matColumnDef="RefDate">
          <th mat-header-cell *matHeaderCellDef> RefDate </th>
          <td mat-cell *matCellDef="let row"> {{row.SRDate | date: 'yyyy-MM-dd'}} </td>
        </ng-container>
        <ng-container matColumnDef="Material">
          <th mat-header-cell *matHeaderCellDef> Material </th>
          <td mat-cell *matCellDef="let row"> {{row.gStrMatDisp}} </td>
        </ng-container>
        <ng-container matColumnDef="Qty">
          <th mat-header-cell *matHeaderCellDef> Quantity </th>
          <td mat-cell *matCellDef="let row"> {{row.srqty}} </td>
        </ng-container>
        <ng-container matColumnDef="Uom">
          <th mat-header-cell *matHeaderCellDef> Uom </th>
          <td mat-cell *matCellDef="let row"> {{row.Uom}} </td>
        </ng-container>
        <ng-container matColumnDef="issQty">
          <th mat-header-cell *matHeaderCellDef> Issued_Qty </th>
          <td mat-cell *matCellDef="let row"> {{row.minqty + row.prqty}} </td>
        </ng-container>
        <ng-container matColumnDef="PendQty">
          <th mat-header-cell *matHeaderCellDef> Pending_Qty</th>
          <td mat-cell *matCellDef="let row"> {{row.srqty - (row.minqty + row.prqty)}} </td>
        </ng-container>
        <ng-container matColumnDef="AvlStock">
          <th mat-header-cell *matHeaderCellDef> Avl_Stock </th>
          <td mat-cell *matCellDef="let row"> {{row.rstock}} </td>
        </ng-container>
        <ng-container matColumnDef="PendingForPo">
          <th mat-header-cell *matHeaderCellDef>Pending_For_PoQty</th>
          <td mat-cell *matCellDef="let row"> {{row.PoPendingQty}} </td>
        </ng-container>
        <ng-container matColumnDef="CurrQty">
          <th mat-header-cell *matHeaderCellDef> Current_Qty </th>
          <td mat-cell *matCellDef="let row"> <input type="text" class="form-control" [(ngModel)]="row.IssueQty"
              (input)="CurrentQtyEvent(row)"> </td>
        </ng-container>
        <ng-container matColumnDef="Min">
          <th mat-header-cell *matHeaderCellDef>Min</th>
          <td mat-cell *matCellDef="let row"> {{row.min_level}} </td>
        </ng-container>
        <ng-container matColumnDef="Max">
          <th mat-header-cell *matHeaderCellDef> Max </th>
          <td mat-cell *matCellDef="let row"> {{row.max_level}} </td>
        </ng-container>
        <ng-container matColumnDef="Reorder">
          <th mat-header-cell *matHeaderCellDef> Reorder </th>
          <td mat-cell *matCellDef="let row"> {{row.reorder_level}} </td>
        </ng-container>
        <ng-container matColumnDef="Priority">
          <th mat-header-cell *matHeaderCellDef>Priority</th>
          <td mat-cell *matCellDef="let row">
            {{ row.priority == 1 ? 'Low' : row.priority == 2 ? 'Medium' : row.priority == 3 ? 'High' : '' }}
          </td>
        </ng-container>
        <ng-container matColumnDef="CapexNo">
          <th mat-header-cell *matHeaderCellDef> CapexNo </th>
          <td mat-cell *matCellDef="let row"> {{row.capexno}} </td>
        </ng-container>
        <ng-container matColumnDef="OldPo">
          <th mat-header-cell *matHeaderCellDef> ViewOldPo </th>
          <td mat-cell *matCellDef="let row"> <mat-icon color="primary" style="text-align: center;"
              (click)="getOldpo(row)">visibility</mat-icon> </td>
        </ng-container>

        <tr mat-header-row
          *matHeaderRowDef="['Select','RefNo','RefDate','Material','Qty','Uom','issQty','PendQty','AvlStock','PendingForPo','CurrQty','Min','Max','Reorder','Priority','CapexNo','OldPo']">
        </tr>
        <tr mat-row
          *matRowDef="let row; columns: ['Select','RefNo','RefDate','Material','Qty','Uom','issQty','PendQty','AvlStock','PendingForPo','CurrQty','Min','Max','Reorder','Priority','CapexNo','OldPo']"
          [ngStyle]="{'background-color': 
                      row.priority === 2 ? 'lightsalmon' :
                      row.priority === 3 ? 'lightgreen' : 'transparent'}">>
        </tr>
      </table>
      <mat-paginator #dataSourcePaginator [pageSizeOptions]="[5,10,50]" showFirstLastButtons></mat-paginator>
    </div>
    <button mat-raised-button type="button" class="float-end mt-3" (click)="getSaveVaild()"
      style="background-color: green;color: white;">Save</button>
  </mat-card-content>

</mat-card>
<ng-template #Oldpo>
  <mat-dialog-content>
    <mat-card>
      <div style="align-items: center; padding: 16px 24px;background-color:  #084eaa;color: white;">View Old Po & Old Indent Records
        <mat-icon style="cursor: pointer;color: rgb(255, 255, 255);float: right;"
          (click)="closeDialog()">close</mat-icon>
      </div>
      <mat-tab-group class="p-2">
        <mat-tab label="Old Po">
          <h4 class="mt-3">Unit 1 <strong style="color: brown;font-weight: 550;">{{this.RawmatName}}</strong></h4>
          <div class="mat-elevation-z8 mt-3">
            <table mat-table #table [dataSource]="oldPoDataSource">
              <ng-container matColumnDef="PoNo">
                <th mat-header-cell *matHeaderCellDef> PoNo </th>
                <td mat-cell *matCellDef="let row"> {{row.pono}} </td>
              </ng-container>
              <ng-container matColumnDef="PoDate">
                <th mat-header-cell *matHeaderCellDef> Po Date </th>
                <td mat-cell *matCellDef="let row"> {{row.podate | date: 'yyyy-MM-dd'}} </td>
              </ng-container>
              <ng-container matColumnDef="Supplier">
                <th mat-header-cell *matHeaderCellDef> Supplier </th>
                <td mat-cell *matCellDef="let row"> {{row.supname}} </td>
              </ng-container>
              <ng-container matColumnDef="Qty">
                <th mat-header-cell *matHeaderCellDef> Po Quantity </th>
                <td mat-cell *matCellDef="let row"> {{row.ord_qty}} </td>
              </ng-container>
              <ng-container matColumnDef="PoRate">
                <th mat-header-cell *matHeaderCellDef> Po Rate </th>
                <td mat-cell *matCellDef="let row"> {{row.porate}} </td>
              </ng-container>
              <ng-container matColumnDef="Discount">
                <th mat-header-cell *matHeaderCellDef> Discount </th>
                <td mat-cell *matCellDef="let row"> {{row.discount}} </td>
              </ng-container>
              <ng-container matColumnDef="Freight">
                <th mat-header-cell *matHeaderCellDef> Freight</th>
                <td mat-cell *matCellDef="let row"> {{row.freight}} </td>
              </ng-container>
              <ng-container matColumnDef="LeadDays">
                <th mat-header-cell *matHeaderCellDef>LeadDays</th>
                <td mat-cell *matCellDef="let row"> {{row.leddays}} </td>
              </ng-container>
              <tr mat-header-row
                *matHeaderRowDef="['PoNo','PoDate','Supplier','Qty','PoRate','Discount','Freight','LeadDays']">
              </tr>
              <tr mat-row
                *matRowDef="let row; columns: ['PoNo','PoDate','Supplier','Qty','PoRate','Discount','Freight','LeadDays']">
              </tr>
            </table>
            <mat-paginator #oldPoPaginator [pageSizeOptions]="[4,10,50]" showFirstLastButtons></mat-paginator>
          </div>

          <h4 class="mt-3">Unit 2 <strong style="color: brown;font-weight: 550;">{{this.RawmatName}}</strong></h4>
          <div class="mat-elevation-z8 mt-3">
            <table mat-table #table [dataSource]="oldPoDataSource2">
              <ng-container matColumnDef="PoNo">
                <th mat-header-cell *matHeaderCellDef> PoNo </th>
                <td mat-cell *matCellDef="let row"> {{row.pono}} </td>
              </ng-container>
              <ng-container matColumnDef="PoDate">
                <th mat-header-cell *matHeaderCellDef> Po Date </th>
                <td mat-cell *matCellDef="let row"> {{row.podate | date: 'yyyy-MM-dd'}} </td>
              </ng-container>
              <ng-container matColumnDef="Supplier">
                <th mat-header-cell *matHeaderCellDef> Supplier </th>
                <td mat-cell *matCellDef="let row"> {{row.supname}} </td>
              </ng-container>
              <ng-container matColumnDef="Qty">
                <th mat-header-cell *matHeaderCellDef> Po Quantity </th>
                <td mat-cell *matCellDef="let row"> {{row.ord_qty}} </td>
              </ng-container>
              <ng-container matColumnDef="PoRate">
                <th mat-header-cell *matHeaderCellDef> Po Rate </th>
                <td mat-cell *matCellDef="let row"> {{row.porate}} </td>
              </ng-container>
              <ng-container matColumnDef="Discount">
                <th mat-header-cell *matHeaderCellDef> Discount </th>
                <td mat-cell *matCellDef="let row"> {{row.discount}} </td>
              </ng-container>
              <ng-container matColumnDef="Freight">
                <th mat-header-cell *matHeaderCellDef> Freight</th>
                <td mat-cell *matCellDef="let row"> {{row.freight}} </td>
              </ng-container>
              <ng-container matColumnDef="LeadDays">
                <th mat-header-cell *matHeaderCellDef>LeadDays</th>
                <td mat-cell *matCellDef="let row"> {{row.leddays}} </td>
              </ng-container>
              <tr mat-header-row
                *matHeaderRowDef="['PoNo','PoDate','Supplier','Qty','PoRate','Discount','Freight','LeadDays']">
              </tr>
              <tr mat-row
                *matRowDef="let row; columns: ['PoNo','PoDate','Supplier','Qty','PoRate','Discount','Freight','LeadDays']">
              </tr>
            </table>
            <mat-paginator #oldPoPaginator1 [pageSizeOptions]="[4,10,50]" showFirstLastButtons></mat-paginator>
          </div>

        </mat-tab>
        <mat-tab label="Old Indent">
          <div class="mat-elevation-z8 mt-3">
            <table mat-table #table [dataSource]="OldIndentDataSource" *ngIf="OldIndentDataSource.data.length !=0">
              <ng-container matColumnDef="pr_ref_no">
                <th mat-header-cell *matHeaderCellDef> Pr_Ref_No </th>
                <td mat-cell *matCellDef="let row"> {{row.PR_Ref_No}} </td>
              </ng-container>
              <ng-container matColumnDef="PrDate">
                <th mat-header-cell *matHeaderCellDef> Pr Date </th>
                <td mat-cell *matCellDef="let row"> {{row.PRDate | date: 'yyyy-MM-dd'}} </td>
              </ng-container>
              <ng-container matColumnDef="Qty">
                <th mat-header-cell *matHeaderCellDef> Indent Quantity </th>
                <td mat-cell *matCellDef="let row"> {{row.Indentqty}} </td>
              </ng-container>
              <ng-container matColumnDef="PoQty">
                <th mat-header-cell *matHeaderCellDef> Po Qty </th>
                <td mat-cell *matCellDef="let row"> {{row.poqty}} </td>
              </ng-container>
              <ng-container matColumnDef="bal">
                <th mat-header-cell *matHeaderCellDef> Balance </th>
                <td mat-cell *matCellDef="let row"> {{row.bal}} </td>
              </ng-container>
              <ng-container matColumnDef="Department">
                <th mat-header-cell *matHeaderCellDef> Department</th>
                <td mat-cell *matCellDef="let row"> {{row.deptname}} </td>
              </ng-container>
              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let row"> {{row.Status}} </td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="['pr_ref_no','PrDate','Qty','PoQty','bal','Department','status']">
              </tr>
              <tr mat-row
                *matRowDef="let row; columns: ['pr_ref_no','PrDate','Qty','PoQty','bal','Department','status']">
              </tr>
            </table>
            <h3 *ngIf="OldIndentDataSource.data.length ==0" style="color: black;">For This <strong
                style="color: brown;font-weight: 550;">{{this.RawmatName}}</strong> No Indent Is Pending</h3>
            <mat-paginator #oldPoPaginator [pageSizeOptions]="[4,10,50]" showFirstLastButtons
              *ngIf="OldIndentDataSource.data.length !=0"></mat-paginator>
          </div>
        </mat-tab>
      </mat-tab-group>
    </mat-card>
  </mat-dialog-content>

</ng-template>